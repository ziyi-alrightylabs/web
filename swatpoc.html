<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Delivery Capture</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #fafafa;
      color: #2c2c2c;
    }
    .container {
      margin-top: 40px;
      margin-bottom: 40px;
    }
    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
      background-color: #ffffff;
    }
    .card-header {
      background-color: #ef6c41;
      color: #ffffff;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      padding: 1rem 1.25rem;
    }
    h5 {
      font-weight: 500;
    }
    .preview-img {
      width: 100px;
      height: 100px;
      margin: 5px;
      border-radius: 8px;
      object-fit: cover;
      border: 2px solid #ddd;
    }
    #signatureCanvas {
      background-color: #ffffff;
      border: 1px solid #ced4da;
      border-radius: 10px;
      width: 100%;
      height: 250px;
    }
    .btn-primary {
      background-color: #ef6c41;
      border-color: #ef6c41;
      font-weight: 500;
    }
    .btn-primary:hover {
      background-color: #e25c32;
      border-color: #e25c32;
    }
    .btn-success {
      background-color: #28a745;
      border-color: #28a745;
    }
    .btn-success:hover {
      background-color: #218838;
      border-color: #1e7e34;
    }
    .btn-secondary {
      background-color: #6c757d;
      border-color: #6c757d;
    }
    .btn-secondary:hover {
      background-color: #5a6268;
      border-color: #545b62;
    }
    .custom-file-upload {
      background-color: #ef6c41;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      display: inline-block;
      font-weight: 500;
      border: none;
    }
    .custom-file-upload:hover {
      background-color: #e25c32;
    }
    #photoInput {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="card-header">Delivery Capture</div>
      <div class="card-body">
        <div id="referralInfo" class="mb-3">
          <p><strong>Booking Information:</strong></p>
          <ul class="list-unstyled">
            <li><strong>Stop #:</strong> 8</li>
            <li><strong>Node ID:</strong> 12852596</li>
            <li><strong>Node UID:</strong> d6bb2131-0988-4683-9352-175c6d1286db</li>
            <li><strong>Node Type:</strong> pickup</li>
            <li><strong>Booking ID:</strong> 6574299</li>
            <li><strong>Booking UID:</strong> d402e36e-3029-487b-95a4-5c91fa912114</li>
            <li><strong>Vehicle ID:</strong> 1877452</li>
            <li><strong>Simulation:</strong> 164919</li>
          </ul>
        </div>

        <div class="text-center">
          <button id="showPayloadBtn" class="btn btn-outline-primary">Show Simulated Payload</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="payloadModal" tabindex="-1" aria-labelledby="payloadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="payloadModalLabel">Simulated POST Payload</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <pre id="payloadContent" class="bg-light p-3 rounded border text-break"></pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function getQueryParams() {
      let params = {};
      let queryString = window.location.search.substring(1);
      let regex = /([^&=]+)=([^&]*)/g;
      let m;
      while ((m = regex.exec(queryString))) {
        params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
      }
      return params;
    }

    const params = getQueryParams();

    document.getElementById("showPayloadBtn").addEventListener("click", function () {
      const simulatedPayload = {
        simulation_id: parseInt(params.simulation) || 172571,
        data: {
          booking_id: parseInt(params.booking_id) || 22151625,
          status: "completed",
          vehicle_id: parseInt(params.vehicle_id) || 17590317,
          booking_uid: params.booking_uid || "e438ab3d-b33a-572d-a114-0a5490e07f40",
          node_type: params.node_type || "dropoff",
          node_id: parseInt(params.node_id) || 48332514,
          node_uid: params.node_uid || "a1d1a6ae-9a0d-40c1-a633-3d6ef05cf7b9"
        },
        current_sim_ts: new Date().toISOString()
      };

      document.getElementById("payloadContent").textContent = JSON.stringify(simulatedPayload, null, 2);
      const modal = new bootstrap.Modal(document.getElementById("payloadModal"));
      modal.show();
    });
  </script>
</body>
</html>
